<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ุฑุงูููุง ุงูุชุฎุงุจ ุฏุณุชฺฉุด ุณฺฏูุง | ูุงุฑุณ</title>
  <!-- ูููุช ู ุงุณุชุงู ุฎุงุฑุฌ -->
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="assets/sigma.css" />
</head>
<body>
  <!-- ุฏฺฉูู ุณูฺ (ููฺฉ ุจู ูุณุฎู EN) -->
  <a class="lang-toggle" href="index-en.html" aria-label="Switch to English">EN</a>

  <header class="header">
    <img src="assets/sigma-logo.png" alt="Sigma Gloves" class="logo" />
  </header>

  <main class="container">
    <!-- Hero -->
    <section class="hero">
      <p id="welcome">
        ุณูุงู! ๐ ูู ุฑุงูููุง ุงูุชุฎุงุจ ุฏุณุชฺฉุดโูุง ุณฺฏูุง ูุณุชู. ฺูุฏ ุณุคุงู ฺฉูุชุงู ูโูพุฑุณู ู ุฏุฑ ูพุงุงูุ ููุงุณุจโุชุฑู ูุฏูโูุง ุฑู ูพุดููุงุฏ ูโุฏู.
      </p>
      <div class="cta">
        <button class="btn" id="startBtn">ุดุฑูุน ฺฏูุชโูฺฏู</button>
        <button class="btn btn--ghost" id="resetBtn" style="display:none">ุดุฑูุน ุฏูุจุงุฑู</button>
      </div>
    </section>

    <!-- Steps -->
    <section class="card">
      <h3>ุฏุฑ ฺู ุตูุนุช ฺฉุงุฑ ูโฺฉูุ</h3>
      <div id="q-industry" class="chips"></div>
    </section>

    <section class="card">
      <h3>ุจุดุชุฑู ุฎุทุฑ ฺฉุงุฑ ุฏุฑ ูุญุทุช ฺูุ</h3>
      <div id="q-hazard" class="chips"></div>
    </section>

    <section class="card">
      <h3>ูุญุท ฺฉุงุฑุช ูุนูููุงู ฺุทูุฑูุ</h3>
      <div id="q-env" class="chips"></div>
    </section>

    <section class="card">
      <h3>ฺ ุจุฑุงุช ูููโุชุฑูุ</h3>
      <div id="q-pref" class="chips"></div>
    </section>

    <!-- Results -->
    <section class="card">
      <h3>ูพุดููุงุฏูุง ููุงุณุจ ุจุฑุง ุชู ๐</h3>
      <div id="results" class="results"></div>
    </section>
  </main>

  <footer class="footer">
    <strong>ุณูุจ ูุณุฆููุช</strong> โ ุชูุตูโูุง ุงู ุฑุงูููุง ุนููู ุจูุฏู ู ุจุฑ ูพุงู ุงุณุชุงูุฏุงุฑุฏูุง EN
    ู ุฏุงุฏูโูุง ูุนู ูุญุตููุงุช ุณฺฏูุง ุงุณุช. ูุทูุงู ูพุด ุงุฒ ุฎุฑุฏ ููุงุ ุดุฑุงุท ูุงูุน ฺฉุงุฑ ู ุจุฑฺฏู ูู ูุญุตูู ุฑุง ุจุฑุฑุณ ฺฉูุฏ.
  </footer>

  <script>
    // --- ุฏุงุฏูโูุง ุซุงุจุช UI ูุงุฑุณ
    const DICT = {
      industries: ['ููุฒฺฉุงุฑ','ุณุงุฎุชูุงู','ุงูุจุงุฑ/ูุฌุณุชฺฉ','ููุช ู ฺฏุงุฒ','ุดูุง','ุนููู'],
      hazards: ['ุจุฑุด','ุณูุฑุงุฎ','ุญุฑุงุฑุช','ููุงุฏ ุดูุง','ุณุฑูุง','ุงุฑุชุนุงุด','ุฑูุบู/ูุบุฒุด'],
      envs: ['ุฎุดฺฉ','ูุฑุทูุจ','ุฑูุบู','ุณุฑุฏ'],
      prefs: ['ููุงุฑุช ู ูุฑู','ุฏูุงู ู ูุญุงูุธุช ุจุดุชุฑ'],
      view: 'ูุดุงูุฏู ูุญุตูู',
      notFoundTitle: 'ูุฏู ุจุง ูฺฺฏโูุง ุฏูู ูพุฏุง ูุดุฏ',
      notFoundText: 'ุงู ูุดุฎุตุงุช ูู ุฑุง ุฌุณุชุฌู ฺฉู ุง ุจุง ุชู ุณฺฏูุง ุชูุงุณ ุจฺฏุฑ:',
      fallbackSpecs: ['Nitrile foam palm','HPPE liner','EN388: 4X43E']
    };

    // --- ูุถุนุช ุงูุชุฎุงุจ ฺฉุงุฑุจุฑ
    const state = { industry:null, hazard:null, env:null, pref:null, catalog:[] };

    // --- ุฑูุฏุฑ ฺูพโูุง
    function renderChips(id, items, key) {
      const box = document.getElementById(id);
      box.innerHTML = '';
      items.forEach(txt => {
        const b = document.createElement('button');
        b.className = 'chip';
        b.type = 'button';
        b.textContent = txt;
        b.addEventListener('click', () => {
          [...box.children].forEach(c => c.classList.add('chip--ghost'));
          b.classList.remove('chip--ghost');
          state[key] = txt;
          renderResults();
        });
        box.appendChild(b);
      });
    }

    // --- ุงูุชุงุฒุฏู ุฎู ุณุจฺฉ (MVP)
    function pickModels() {
      let picks = [];

      // ุฎุทุฑ ุจุฑุด โ HPPE
      if (state.hazard && state.hazard.includes('ุจุฑุด')) {
        picks.push('+921', '+911', '922');
      }
      // ูุญุท ุฑูุบู โ ูุชุฑู
      if (state.env && state.env.includes('ุฑูุบู')) {
        picks.unshift('348', '342', '344', '332', '312', '346');
      }
      // ูุฑุทูุจ โ ููู/ูุงุชฺฉุณ
      if (state.env && state.env.includes('ูุฑุทูุจ')) {
        picks.push('+485', '412', '+422', '418', '432');
      }
      // ุณุฑุฏ โ ุฒูุณุชุงู
      if (state.env && state.env.includes('ุณุฑุฏ')) {
        picks.push('+446', '+434');
      }

      // ุชุฑุฌุญ ููุงุฑุช โ ุงูููุช ูุฏูโูุง ุณุจฺฉโุชุฑ ุฑุง ุฌููุชุฑ ุจุงูุฑ
      if (state.pref && state.pref.includes('ููุงุฑุช')) {
        picks = prioritize(picks, ['+485','412','418','432','+911','922']);
      }
      // ุชุฑุฌุญ ุฏูุงู โ ูุฏูโูุง ุตูุนุช/ูุชุฑู ุฌููุชุฑ
      if (state.pref && state.pref.includes('ุฏูุงู')) {
        picks = prioritize(picks, ['344','332','346','348','342','+422']);
      }

      // ฺฉุชุง ู ูุญุฏูุฏ ุจู 3
      return [...new Set(picks)].slice(0, 3);
    }
    function prioritize(arr, preferred) {
      const set = new Set(preferred);
      return [...new Set([...arr.filter(x => set.has(x)), ...arr.filter(x => !set.has(x))])];
    }

    // --- ุฑูุฏุฑ ูุชุงุฌ
    function renderResults() {
      const wrap = document.getElementById('results');
      wrap.innerHTML = '';
      const pickCodes = pickModels();

      if (!pickCodes.length) {
        const card = document.createElement('div');
        card.className = 'rec';
        card.innerHTML = `
          <h4>${DICT.notFoundTitle}</h4>
          <p>${DICT.notFoundText}</p>
          <ul>${DICT.fallbackSpecs.map(s => `<li>${s}</li>`).join('')}</ul>
        `;
        wrap.appendChild(card);
        return;
      }

      pickCodes.forEach(code => {
        const m = state.catalog.find(x => x.code === code);
        if (!m) return;

        const card = document.createElement('div');
        card.className = 'rec';
        const std = m.standards?.en388 ? `EN388: ${m.standards.en388}` : 'EN388: โ';

        card.innerHTML = `
          <h4>๐งค ${m.name} <span class="badge">${m.code}</span></h4>
          <div class="std">${std}</div>
          <div class="feat">${(m.features || []).join('ุ ')}</div>
          <div class="why">${m.why || ''}</div>
          <a class="btn" target="_blank" rel="noopener" href="${m.link}">${DICT.view}</a>
        `;
        wrap.appendChild(card);
      });
    }

    // --- ุฑุงูโุงูุฏุงุฒ
    async function boot() {
      // ฺูพโูุง
      renderChips('q-industry', DICT.industries, 'industry');
      renderChips('q-hazard', DICT.hazards, 'hazard');
      renderChips('q-env', DICT.envs, 'env');
      renderChips('q-pref', DICT.prefs, 'pref');

      // ุจุงุฑฺฏุฐุงุฑ ฺฉุงุชุงููฺฏ ูุงุฑุณ
      const res = await fetch('data/fa_catalog.json'); // ุญุชูุง ุตูุญู ุฑุง ุจุง http ุณุฑู ฺฉู (ูุซูุงู live server)
      state.catalog = await res.json();

      document.getElementById('startBtn').addEventListener('click', () => {
        document.getElementById('resetBtn').style.display = 'inline-block';
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
      });
      document.getElementById('resetBtn').addEventListener('click', () => {
        state.industry = state.hazard = state.env = state.pref = null;
        document.querySelectorAll('.chip').forEach(ch => ch.classList.remove('chip--ghost'));
        renderResults();
      });

      renderResults();
    }
    boot();
  </script>
</body>
</html>
