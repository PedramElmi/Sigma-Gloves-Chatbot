<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ú†Øªâ€ŒØ¨Ø§Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø³ØªÚ©Ø´ â€” Ø³ÛŒÚ¯Ù…Ø§</title>

  <!-- ÙÙˆÙ†Øª / Ø§Ø³ØªØ§ÛŒÙ„ -->
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="assets/sigma-style.css" />

  <!-- Logic: KnowledgeEngine + optional ProductMatcher -->
  <script src="assets/knowledge_engine.js" defer></script>
  <script src="assets/product_matcher.js" defer></script>

<style>
    /* Inline small LTR-specific overrides to mirror Persian file visually */
    :root { --card-width: 820px; }
    html,body { height: 100%; margin:0; background: #f7f7f8; }
    body { font-family: "Vazirmatn", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; display:flex; flex-direction:column; min-height:100vh; }

    /* header center alignment kept as in Persian */
    .app-header .title { text-align:center; line-height:1; direction:ltr; }

     /* ØµÙØ­Ù‡ Ø¨Ù†Ø¯ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª Ú©Ù„Ø§Ø³ÛŒÚ© ChatGPT-like */
    :root { --card-width: 820px; }
    html,body { height: 100%; margin:0; background: #f7f7f8; }
    body { font-family: "Vazirmatn", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; display:flex; flex-direction:column; min-height:100vh; }

    /* Ù‡Ø¯Ø± Ø«Ø§Ø¨Øª Ø¨Ø§Ù„Ø§ */
    .app-header {
      position: fixed;
      inset: 0 0 auto 0;
      height: 72px;
      background: #fff;
      border-bottom: 3px solid var(--red);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:1200;
      box-shadow: 0 8px 24px rgba(0,0,0,0.06);
      padding: 0 12px;
    }
    .app-header .inner { width: min(1120px, 96vw); display:flex; align-items:center; justify-content:center; gap:14px; }
    .app-header img.logo { height:46px; }
    .app-header .title { text-align:center; line-height:1; }
    .app-header h1 { margin:0; font-size:1.05rem; font-weight:800; color:var(--black); }
    .app-header p { margin:0; color:var(--gray); font-size:0.85rem; }

    /* Ù…Ø­Ù„ Ù‚Ø±Ø§Ø±Ú¯ÛŒØ±ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ (Ø²ÛŒØ± Ù‡Ø¯Ø±) */
    .main-wrap { display:flex; align-items:center; justify-content:center; flex:1; padding:96px 16px 36px; }

    /* Ú©Ø§Ø±Øª Ú†Øª (Ù…Ø±Ú©Ø²) */
    .chat-card {
      width:100%;
      max-width: var(--card-width);
      height: calc(78vh);
      min-height: 520px;
      background:#fff;
      border-radius:12px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.08);
      overflow: hidden;
      display:flex;
      flex-direction:column;
      border:1px solid #ececec;
    }

    /* Ø¨Ø§Ù„Ø§ÛŒ Ú©Ø§Ø±Øª (compact header) */
    .chat-card .top {
      padding:12px 16px;
      border-bottom:1px solid #f0f0f0;
      display:flex;
      align-items:center;
      gap:12px;
    }
    .chat-card .top .mini-logo { width:40px;height:40px;border-radius:8px;background:linear-gradient(135deg,var(--red),var(--red-dark)); display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800; }

    /* Ù†Ø§Ø­ÛŒÙ‡Ù” Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§: Ø§Ø³Ú©Ø±ÙˆÙ„â€ŒÙ¾Ø°ÛŒØ± */
    #chat-container {
      flex:1;
      padding:18px;
      overflow-y:auto;
      display:flex;
      flex-direction:column;
      gap:12px;
      background:linear-gradient(180deg,#fff,#fbfbfb);
    }

    /* Ø§Ø³ØªØ§ÛŒÙ„ Ø­Ø¨Ø§Ø¨â€ŒÙ‡Ø§ */
    .msg { max-width:78%; padding:12px 14px; border-radius:12px; word-break:break-word; box-shadow: 0 6px 18px rgba(0,0,0,0.04); }
    .msg.bot { align-self:flex-start; background:#111; color:#fff; border-bottom-left-radius:6px; }
    .msg.user { align-self:flex-end; background:var(--red); color:#fff; border-bottom-right-radius:6px; }

    /* ÙˆØ±ÙˆØ¯ÛŒ Ø«Ø§Ø¨Øª Ù¾Ø§ÛŒÛŒÙ† Ú©Ø§Ø±Øª */
    .chat-input {
      display:flex; gap:10px; align-items:center; padding:12px; border-top:1px solid #f0f0f0; background:#fff;
    }
    #user-input {
      flex:1; padding:12px 14px; border-radius:10px; border:1px solid #e7e7e7; background:#fafafa; outline:none; font-size:15px;
    }
    #user-input:focus { box-shadow: 0 8px 24px rgba(0,0,0,0.06); border-color:var(--red); background:#fff; }
    #send-btn { background:var(--red); color:#fff; border:none; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; box-shadow: 0 8px 20px rgba(227,6,19,0.14); }
    #send-btn:disabled { opacity:0.5; cursor:not-allowed; transform:none; box-shadow:none; }

    /* Ù…ØªÙ† Ú©Ù…Ú©ÛŒ */
    .small { font-size:13px; color:var(--gray); }

    /* ÙˆØ§Ú©Ù†Ø´ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ */
    .clarify { font-style:italic; color:var(--gray); }

    /* responsive */
    @media (max-width:720px) {
      .app-header { height:64px; }
      .main-wrap { padding-top:84px; padding-left:12px; padding-right:12px; }
      .chat-card { height: calc(84vh); min-height:420px; width:100%; }
    }

    /* ========================================
   SIGMA GLOVES â€” Revamped UI
   Persian-friendly font + glossy, modern card style
   Place this file at: assets/sigma.css
   If you have local fonts, put them in assets/fonts/ and adjust @font-face src.
   ======================================== */

/* ====== Font loading (edit paths to your local font files if available) ====== */
@font-face {
  font-family: "IranSansCustom";
  src: url("assets/fonts/IranSans-Regular.woff2") format("woff2"),
       url("assets/fonts/IranSans-Regular.woff") format("woff");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: "IranSansCustom";
  src: url("assets/fonts/IranSans-Bold.woff2") format("woff2"),
       url("assets/fonts/IranSans-Bold.woff") format("woff");
  font-weight: 700;
  font-style: bold;
  font-display: swap;
}

/* Fallback stack: Vazirmatn / Shabnam / Tahoma as fallback */
:root {
  --red: #c8102e;        /* slightly deeper brand red */
  --red-2: #e30026;
  --black: #0f1113;
  --muted: #62656a;
  --bg-soft: #f4f5f7;
  --card: #ffffff;
  --glass: rgba(255,255,255,0.7);
  --chip-bg: linear-gradient(180deg,#f8eef0,#f3d7db);
  --radius-xl: 16px;
  --radius-lg: 12px;
  --shadow-1: 0 6px 20px rgba(18,22,26,0.06);
  --shadow-2: 0 18px 50px rgba(10,12,14,0.08);
  --glow: 0 8px 30px rgba(200,31,31,0.12);
  --max-width: 1100px;
  --font-main: "IranSansCustom", "Vazirmatn", "Shabnam", Tahoma, "Helvetica Neue", Arial, sans-serif;
}

/* ====== Reset & base ====== */
* { box-sizing: border-box; }
html,body { height:100%; }
body {
  margin:0;
  font-family: var(--font-main);
  background: linear-gradient(180deg,var(--bg-soft), #f7f8fa);
  color: var(--black);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  line-height:1.5;
  font-size:15px;
}

/* ====== Header (fixed) ====== */
.app-header {
  position: fixed;
  top: 0; left: 0; right: 0;
  height:76px;
  background: linear-gradient(180deg,#fff,#fdfdfd);
  border-bottom: 3px solid rgba(200,31,31,0.95);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1200;
  box-shadow: 0 10px 36px rgba(12,14,16,0.05);
  padding: 0 12px;
}
.app-header .inner {
  width: min(var(--max-width), 96vw);
  display:flex;
  gap:20px;
  align-items:center;
  justify-content:center;
}
.app-header img.logo { height:48px; width:auto; display:block; }
.app-header .title { text-align:center; }
.app-header h1 { margin:0; font-size:1.06rem; font-weight:700; color:var(--black); }
.app-header p { margin:0; font-size:0.88rem; color:var(--muted); }

/* language toggle (top-right) */
.lang-toggle {
  position: fixed;
  top: 12px;
  right: 12px;
  z-index:1250;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  height:38px;
  padding:0 .9rem;
  background: rgba(16,18,20,0.95);
  color:#fff;
  border-radius:8px;
  font-weight:700;
  text-decoration:none;
  box-shadow: 0 8px 30px rgba(0,0,0,0.12);
  transition: transform .15s ease, background .18s ease;
}
.lang-toggle:hover { transform:translateY(-3px); background: var(--red); }

/* ====== Page container ====== */
.main-wrap {
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding: 110px 16px 48px; /* account for header */
  min-height: calc(100vh - 110px);
}

/* ====== Hero / intro card (above chat) ====== */
.hero {
  width: min(var(--max-width), 96vw);
  margin: 0 auto 18px;
  background: linear-gradient(180deg, var(--red), var(--red-2));
  color:#fff;
  border-radius:14px;
  padding:20px;
  box-shadow: var(--shadow-2);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.hero .copy { max-width:70%; }
.hero p { margin:0; font-weight:600; }
.hero .cta { background: rgba(255,255,255,0.08); color:#fff; padding:10px 14px; border-radius:10px; font-weight:700; text-decoration:none; }

/* ====== Chat form layout similar to screenshot (cards stacked) ====== */
.stack {
  width: min(var(--max-width), 96vw);
  margin: 0 auto;
  display: grid;
  gap: 18px;
}

/* each selection card */
.card {
  background: var(--card);
  border-radius: var(--radius-lg);
  padding: 18px;
  box-shadow: var(--shadow-1);
  border: 1px solid #f0f0f1;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.card h3 {
  margin:0;
  color:var(--red-2);
  font-size:1.05rem;
  font-weight:700;
}

/* chips */
.chips { display:flex; flex-wrap:wrap; gap:10px; margin-top:6px; }
.chip {
  background: linear-gradient(180deg,#fff,#f7f7f9);
  border: 1px solid rgba(200,31,31,0.08);
  color: var(--red-2);
  padding:8px 14px;
  border-radius: 12px;
  cursor:pointer;
  font-weight:700;
  box-shadow: 0 8px 20px rgba(200,31,31,0.06);
  transition: transform .12s ease, box-shadow .15s ease, background .15s ease;
}
.chip:hover { transform:translateY(-3px); box-shadow: 0 16px 36px rgba(200,31,31,0.12); background: var(--chip-bg); }
.chip.active {
  background: linear-gradient(180deg,var(--red),var(--red-2));
  color:#fff;
  box-shadow: var(--glow);
  transform:translateY(-2px);
}

/* ====== Chat page (center card ChatGPT-like) ====== */
.chat-card {
  width:100%;
  max-width:880px;
  margin: 6px auto;
  border-radius: 14px;
  overflow:hidden;
  background: linear-gradient(180deg,#ffffff,#fbfbfb);
  box-shadow: var(--shadow-2);
  border: 1px solid #ececec;
}

/* chat header inside card */
.chat-card .top {
  padding:12px 18px;
  display:flex;
  align-items:center;
  gap:12px;
  border-bottom:1px solid #f2f2f3;
}
.mini-logo {
  width:44px; height:44px; border-radius:10px;
  background: linear-gradient(135deg,var(--red),var(--red-2));
  color:#fff; display:flex; align-items:center; justify-content:center; font-weight:800;
  box-shadow: 0 10px 28px rgba(200,31,31,0.08);
}

/* interactive chat area: white with scroll */
#chat-container {
  min-height:420px;
  max-height:64vh;
  overflow:auto;
  padding:22px;
  display:flex;
  flex-direction:column;
  gap:14px;
  background: linear-gradient(180deg,#fff,#fffeff);
}

/* message bubbles (soft, friendly) */
.msg {
  max-width:76%;
  padding:14px 18px;
  border-radius:14px;
  box-shadow: 0 10px 30px rgba(18,22,26,0.04);
  font-size:15px;
  line-height:1.5;
}
.msg.bot {
  align-self:flex-start;
  background: linear-gradient(180deg,#2b3034,#222528); /* dark gray */
  color:#fff;
  border-bottom-left-radius:8px;
}
.msg.user {
  align-self:flex-end;
  background: linear-gradient(180deg,var(--red),var(--red-2));
  color:#fff;
  border-bottom-right-radius:8px;
  box-shadow: 0 14px 36px rgba(200,31,31,0.14);
}

/* suggestions list */
.suggestions { list-style:none; padding:0; margin:6px 0 0; display:grid; gap:10px; }
.suggestions li { background: #fff; border:1px solid #f1f1f1; padding:10px 12px; border-radius:10px; box-shadow: 0 8px 22px rgba(14,16,18,0.03); }
a.prod-link { color:var(--red); font-weight:700; text-decoration:none; }

/* chat input footer */
.chat-input {
  display:flex;
  gap:12px;
  align-items:center;
  padding:14px;
  border-top: 1px solid #f2f2f3;
  background: linear-gradient(180deg,#fff,#fbfbfb);
}
#user-input {
  flex:1;
  padding:12px 16px;
  border-radius:12px;
  border:1px solid #ececec;
  background:#fff;
  outline:none;
  font-size:15px;
  box-shadow: inset 0 6px 18px rgba(12,14,16,0.02);
}
#user-input::placeholder { color:#a7adb3; }
#send-btn {
  background: linear-gradient(180deg,var(--red),var(--red-2));
  color:#fff;
  padding:10px 16px;
  border-radius:12px;
  border:none;
  font-weight:800;
  box-shadow: 0 12px 34px rgba(200,31,31,0.18);
  cursor:pointer;
}

/* footer small text */
.footer {
  text-align:center;
  color:var(--muted);
  padding:18px 12px;
  font-size:13px;
}

/* subtle animations */
@keyframes rise { from { transform: translateY(6px); opacity:0 } to { transform: translateY(0); opacity:1 } }
.msg { animation: rise .28s ease both; }
.chip { transition: transform .15s ease, box-shadow .18s ease; }

/* responsive */
@media (max-width:900px) {
  .main-wrap { padding-top:110px; }
  .stack { gap:14px; }
  .chat-card { margin:12px; width:calc(100% - 24px); max-width:100%; }
  #chat-container { max-height:58vh; padding:16px; }
  .msg { font-size:14px; padding:12px 14px; }
  .hero .copy { max-width:60%; }
}
@media (max-width:520px) {
  .app-header .inner { justify-content:center; gap:8px; }
  .app-header h1 { font-size:1rem; }
  .hero { padding:14px; border-radius:12px; }
  .chip { padding:8px 10px; font-size:14px; }
  #user-input { font-size:14px; padding:10px 12px; }
  #chat-container { max-height:52vh; }
}

/* ====== Chat Ribbon (inside card) ====== */
.chat-ribbon {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 18px;
  background: linear-gradient(135deg, #c8102e 0%, #a60d22 100%);
  color: #fff;
  border-bottom: 1px solid rgba(255,255,255,0.15);
  box-shadow: 0 3px 10px rgba(200,16,46,0.2);
  position: relative;
}

.chat-ribbon-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.chat-ribbon-logo {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  background: #fff;
  color: #e30026;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 700;
  box-shadow: 0 4px 12px rgba(255,255,255,0.2);
}

.chat-ribbon-info {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.chat-ribbon-title {
  font-weight: 800;
  font-size: 1rem;
  line-height: 1;
}

.chat-ribbon-status {
  font-size: 0.85rem;
  opacity: 0.9;
}

/* blinking dot on right */
.chat-ribbon-right {
  display: flex;
  align-items: center;
}
.chat-ribbon-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #00e676;
  box-shadow: 0 0 10px #00e676;
  animation: pulse 1.2s infinite ease-in-out;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.5); opacity: 0.6; }
}
/* ====== Chat Ribbon (inside card) ====== */
.chat-ribbon {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 18px;
  background: linear-gradient(135deg, #e30026 0%, #e30026 100%);
  color: #fff;
  border-bottom: 1px solid rgba(255,255,255,0.15);
  box-shadow: 0 3px 10px rgba(200,16,46,0.2);
  position: relative;
}

.chat-ribbon-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.chat-ribbon-logo {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  background: #fff;
  color: #e30026;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 700;
  box-shadow: 0 4px 12px rgba(255,255,255,0.2);
}

.chat-ribbon-info {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.chat-ribbon-title {
  font-weight: 800;
  font-size: 1rem;
  line-height: 1;
}

.chat-ribbon-status {
  font-size: 0.85rem;
  opacity: 0.9;
}

/* blinking dot on right */
.chat-ribbon-right {
  display: flex;
  align-items: center;
}
.chat-ribbon-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #00e676;
  box-shadow: 0 0 10px #00e676;
  animation: pulse 1.2s infinite ease-in-out;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.5); opacity: 0.6; }
}

  </style>
</head>
<body>
  <!-- language switch -->
  <a class="lang-toggle" href="chat-en.html" aria-label="Switch to English">EN</a>

  <header class="app-header" role="banner">
    <div class="inner">
      <div style="display:flex;align-items:center;gap:12px;">
        <img src="assets/sigma-logo.png" alt="Sigma Gloves" class="logo" />
        <div class="title">
          <h1>Ú†Øªâ€ŒØ¨Ø§Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø³ØªÚ©Ø´ â€” Ø³ÛŒÚ¯Ù…Ø§</h1>
          <p>Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¯Ø³ØªÚ©Ø´ Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ú©Ø§Ø±ØŒ Ø®Ø·Ø± Ùˆ Ù…Ø­ÛŒØ· Ú©Ø§Ø±ÛŒ Ø´Ù…Ø§</p>
        </div>
      </div>
    </div>
  </header>

  <main class="main-wrap" role="main">
    <section class="chat-card" aria-label="Sigma Chat Assistant">
      <div class="chat-ribbon" role="region" aria-live="polite">
        <div style="display:flex;gap:12px;align-items:center">
          <div class="chat-ribbon-logo">ğŸ§¤</div>
          <div>
            <div class="chat-ribbon-title">Ø¯Ø³ØªÛŒØ§Ø± Ø³ÛŒÚ¯Ù…Ø§</div>
            <div id="chatStatus" class="small" style="opacity:0.95">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
          </div>
        </div>
        <div class="small" id="sessionHint">Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø¨Ù†ÙˆÛŒØ³: Ù…Ø«Ù„Ø§Ù‹ Â«Ø¬ÙˆØ´Ú©Ø§Ø±ÛŒÂ» ÛŒØ§ Â«Ù†Ù…Ø§ÛŒÙ†Ø¯Ú¯ÛŒ Ù…Ø´Ù‡Ø¯Â»</div>
      </div>

      <!-- messages -->
      <div id="chat-container" aria-live="polite" aria-atomic="false"></div>

      <!-- input -->
      <form id="chat-form" class="chat-input" onsubmit="return false;" aria-label="Chat input form">
        <input id="user-input" type="text" autocomplete="off" inputmode="text"
               placeholder="Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø¨Ù†ÙˆÛŒØ³: Ù…Ø«Ù„Ø§Ù‹ Ø¬ÙˆØ´Ú©Ø§Ø±ÛŒ ÛŒØ§ Ù†Ù…Ø§ÛŒÙ†Ø¯Ú¯ÛŒ..." required aria-required="true" />
        <button id="send-btn" type="submit" aria-label="Ø§Ø±Ø³Ø§Ù„">Ø§Ø±Ø³Ø§Ù„</button>
      </form>
    </section>
  </main>

  <footer style="text-align:center;padding:14px;color:var(--muted);font-size:13px;">
    Â© Sigma Gloves â€” Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø³ØªÚ©Ø´. Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙÙ†ÛŒ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø´ÛŒØª Ù…Ø­ØµÙˆÙ„ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯.
  </footer>

  <script>
    /* ================================
       Chat frontend logic (FA)
       - uses window.KnowledgeEngine
       - optional ProductMatcher if available
       ================================ */

    const chatContainer = document.getElementById('chat-container');
    const input = document.getElementById('user-input');
    const form = document.getElementById('chat-form');
    const sendBtn = document.getElementById('send-btn');
    const statusEl = document.getElementById('chatStatus');
    const sessionHint = document.getElementById('sessionHint');

    // small helper: escape text for HTML
    function esc(s){ if (s===null||s===undefined) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    function appendMessage(sender, htmlContent) {
      const el = document.createElement('div');
      el.className = 'msg ' + (sender === 'bot' ? 'bot' : 'user');
      el.innerHTML = htmlContent;
      chatContainer.appendChild(el);
      el.scrollIntoView({behavior:'smooth', block:'end'});
    }

    function setStatus(t) {
      statusEl.textContent = t;
    }

    // small typing indicator
    function botTypingThenSay(text, delay = 600) {
      setStatus('Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø§Ø³Ø®... âœï¸');
      const t = document.createElement('div');
      t.className = 'msg bot';
      t.innerHTML = "<span class='small'>Ø¯Ø± Ø­Ø§Ù„ ØªØ§ÛŒÙ¾...</span>";
      chatContainer.appendChild(t);
      t.scrollIntoView({behavior:'smooth', block:'end'});
      return new Promise(resolve => {
        setTimeout(() => {
          t.remove();
          appendMessage('bot', text);
          setStatus('Ø¢Ù†Ù„Ø§ÛŒÙ† âœ…');
          resolve();
        }, delay);
      });
    }

    // initial flow state for step-based hazard/product questioning
    const STEPS = [
      { key: "industry", q: "Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø¨Ú¯Ùˆ Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯ÛŒØŸ (Ù…Ø«Ù„Ø§Ù‹: Ø¬ÙˆØ´Ú©Ø§Ø±ÛŒØŒ Ù†Ø¬Ø§Ø±ÛŒØŒ Ø§Ù†Ø¨Ø§Ø±)", ph: "Ù…Ø«Ù„Ø§Ù‹: Ø¬ÙˆØ´Ú©Ø§Ø±ÛŒØŒ Ù†Ø¬Ø§Ø±ÛŒØŒ Ø§Ù†Ø¨Ø§Ø±..." },
      { key: "hazard", q: "Ø®Ø·Ø± Ø§ØµÙ„ÛŒ Ú©Ø§Ø±Øª Ú†ÛŒÙ‡ØŸ (Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø±Ø´ØŒ Ø³ÙˆØ±Ø§Ø®ØŒ Ø­Ø±Ø§Ø±ØªØŒ Ù…ÙˆØ§Ø¯ Ø´ÛŒÙ…ÛŒØ§ÛŒÛŒØŒ Ø¶Ø±Ø¨Ù‡)", ph: "Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø±Ø´ØŒ Ø³ÙˆØ±Ø§Ø®ØŒ Ø­Ø±Ø§Ø±Øª..." },
      { key: "env", q: "Ù…Ø­ÛŒØ· Ú©Ø§Ø±Øª Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ú†Ø·ÙˆØ±Ù‡ØŸ (Ø®Ø´Ú©/Ù…Ø±Ø·ÙˆØ¨/Ø±ÙˆØºÙ†ÛŒ/Ø³Ø±Ø¯)", ph: "Ù…Ø«Ù„Ø§Ù‹: Ø±ÙˆØºÙ†ÛŒØŒ Ù…Ø±Ø·ÙˆØ¨ØŒ Ø³Ø±Ø¯..." },
      { key: "pref", q: "ØªØ±Ø¬ÛŒØ­ÛŒ Ø¯Ø§Ø±ÛŒØŸ (Ø±Ø§Ø­ØªÛŒØŒ Ø¯ÙˆØ§Ù…ØŒ Ú†Ø³Ø¨Ù†Ø¯Ú¯ÛŒØŒ Ø¶Ø¯Ø­Ù„Ø§Ù„)", ph: "Ù…Ø«Ù„Ø§Ù‹: Ø±Ø§Ø­ØªÛŒØŒ Ø¯ÙˆØ§Ù…ØŒ Ø¶Ø¯ Ù„ØºØ²Ø´..." }
    ];
    const CLARIFY_PROMPT = "Ù…Ù†Ø¸ÙˆØ±Øª Ø§Ø² Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ Ú†ÛŒÙ‡ØŸ Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø±Ø´ØŒ Ø³ÙˆØ±Ø§Ø®ØŒ Ø­Ø±Ø§Ø±ØªØŸ";
    let step = 0;
    const answers = { industry:null, hazard:null, env:null, pref:null };

    // init: ensure KnowledgeEngine is ready
    async function init() {
      try {
        setStatus('Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³ÛŒØ³ØªÙ…...');
        if (window.KnowledgeEngine && typeof KnowledgeEngine.init === 'function') {
          await KnowledgeEngine.init('/assets/knowledge_base_fa.json');
          setStatus('Ø¢Ù†Ù„Ø§ÛŒÙ† âœ…');
        } else {
          setStatus('KnowledgeEngine ÛŒØ§ÙØª Ù†Ø´Ø¯ â€” Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ù…Ø­Ù„ÛŒ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø¨ÙˆØ¯');
        }
      } catch (err) {
        console.warn('KB init error', err);
        setStatus('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ KB');
      }
      // welcome
      await botTypingThenSay('Ø³Ù„Ø§Ù… ğŸ‘‹ Ù…Ù† Ø¯Ø³ØªÛŒØ§Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø³ØªÚ©Ø´ Ø³ÛŒÚ¯Ù…Ø§ Ù‡Ø³ØªÙ…. Ø¨Ù‡Ù… Ø¨Ú¯Ùˆ Ú†Ù‡ Ú©Ù…Ú©ÛŒ Ø§Ø² Ù…Ù† Ø¨Ø±Ù…ÛŒØ§Ø¯ØŸ');
      input.placeholder = STEPS[0].ph;
      input.focus();
    }

    // product matching helper (uses ProductMatcher if present, otherwise fallback)
    async function findProducts({ hazard, env, pref, industry }, topN = 6) {
      // try ProductMatcher
      try {
        if (window.ProductMatcher && typeof ProductMatcher.pickProducts === 'function') {
          const picks = await ProductMatcher.pickProducts({ hazard, env, pref, industry }, { topN });
          if (Array.isArray(picks) && picks.length) return picks;
        }
      } catch (err) {
        console.warn('ProductMatcher error', err);
      }

      // fallback mapping (simple heuristics based on hazard token)
      const h = (hazard || '').toLowerCase();
      const picksFallback = [];
      if (h.match(/Ø¨Ø±Ø´|cut/)) {
        picksFallback.push({ title_fa: "Ø¯Ø³ØªÚ©Ø´ Ø¶Ø¯ Ø¨Ø±Ø´ HPPE 911", url: "https://sigmagloves.com/products/sigma-911-cut-resistant-work-gloves/", why: "Ù…Ù‚Ø§ÙˆÙ…Øª Ø¨Ø±Ø´ÛŒ Ø³Ø·Ø­ Ø¨Ø§Ù„Ø§ (CUT 5) â€” Ù…Ù†Ø§Ø³Ø¨ Ú©Ø§Ø± Ø¨Ø§ ØªÛŒØºÙ‡ Ùˆ Ø´ÛŒØ´Ù‡" });
        picksFallback.push({ title_fa: "Ø¯Ø³ØªÚ©Ø´ Ø¶Ø¯ Ø¨Ø±Ø´ 921", url: "https://sigmagloves.com/products/sigma-921-cut-resistant-work-gloves/", why: "HPPE â€” Ù…Ø­Ø§ÙØ¸Øª Ø¨Ø§Ù„Ø§ Ùˆ Ø³Ø¨Ú©" });
      }
      if (h.match(/Ø±ÙˆØºÙ†|Ø­Ù„Ø§Ù„|Ù†ÛŒØªØ±ÛŒÙ„|oil|solvent/)) {
        picksFallback.push({ title_fa: "Ø¯Ø³ØªÚ©Ø´ Ù†ÛŒØªØ±ÛŒÙ„ 348", url: "https://sigmagloves.com/products/sigma-986-cut-resistant-work-gloves/", why: "Ù…Ù‚Ø§ÙˆÙ…Øª Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± Ø±ÙˆØºÙ† Ùˆ Ø­Ù„Ø§Ù„ â€” Ù…Ù†Ø§Ø³Ø¨ Ù†ÙØª Ùˆ Ù¾ØªØ±ÙˆØ´ÛŒÙ…ÛŒ" });
        picksFallback.push({ title_fa: "Ø¯Ø³ØªÚ©Ø´ Ù†ÛŒØªØ±ÛŒÙ„ 332", url: "https://sigmagloves.com/products/sigma-332-nitrile-work-gloves/", why: "Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø®ÙˆØ¨ Ø¯Ø± Ø¯Ù…Ø§Ù‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ùˆ Ù…Ù‚Ø§ÙˆÙ…Øª Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± Ø³ÙˆØ±Ø§Ø® Ø´Ø¯Ú¯ÛŒ" });
      }
      if (h.match(/Ú¯Ø±Ù…Ø§|Ø­Ø±Ø§Ø±Øª|heat/)) {
        picksFallback.push({ title_fa: "Ø¯Ø³ØªÚ©Ø´ Ø­Ø±Ø§Ø±ØªÛŒ (Ø¢Ù„ÙˆÙ…ÛŒÙ†ÛŒÙˆÙ…ÛŒ/Ù†Ø³ÙˆØ²)", url: "#", why: "Ù…Ø­Ø§ÙØ¸Øª Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± Ø¯Ù…Ø§Ù‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ùˆ Ø°Ø±Ø§Øª Ù…Ø°Ø§Ø¨ â€” Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ø±ÛŒØ®ØªÙ‡â€ŒÚ¯Ø±ÛŒ Ùˆ Ø¬ÙˆØ´Ú©Ø§Ø±ÛŒ" });
      }
      // generic picks
      if (picksFallback.length === 0) {
        picksFallback.push({ title_fa: "Ø¯Ø³ØªÚ©Ø´ Ù„Ø§ØªÚ©Ø³ ÙÙˆÙ…ÛŒ +485", url: "https://sigmagloves.com/products/sigma-485-latex-work-gloves/", why: "Ø¯ÙˆØ§Ù…ØŒ Ú†Ù†Ú¯Ø´ Ø®ÙˆØ¨ Ùˆ Ø±Ø§Ø­ØªÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ" });
        picksFallback.push({ title_fa: "Ø¯Ø³ØªÚ©Ø´ 412 Ù„Ø§ØªÚ©Ø³", url: "https://sigmagloves.com/products/sigma-412-latex-work-gloves/", why: "Ù‚ÛŒÙ…Øª Ù…Ù†Ø§Ø³Ø¨ØŒ Ù…Ù‚Ø§ÙˆÙ…Øª Ø´ÛŒÙ…ÛŒØ§ÛŒÛŒ Ù¾Ø§ÛŒÙ‡ Ùˆ Ø¶Ø¯ Ù„ØºØ²Ø´" });
      }
      return picksFallback.slice(0, topN);
    }

    // handle KB (knowledge) questions
    async function handleKBQuery(text) {
      setStatus('Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø§Ø·Ù„Ø§Ø¹Ø§Øª... ğŸ”');
      // safe call
      try {
        if (window.KnowledgeEngine && typeof KnowledgeEngine.query === 'function') {
          const res = await KnowledgeEngine.query(text, { topN: 6 });
          if (res && res.length) {
            let html = `<p class="small">ğŸ” Ù†ØªØ§ÛŒØ¬ Ù…Ø±ØªØ¨Ø·:</p><ul class="suggestions">`;
            for (const r of res) {
              const title = esc(r.title || r.id || 'Ù†ØªÛŒØ¬Ù‡');
              const snip = esc(r.snippet || '');
              const url = esc(r.url || '#');
              html += `<li><div><a class="prod-link" href="${url}" target="_blank" rel="noopener noreferrer">${title}</a></div><div class="small" style="margin-top:6px;color:var(--muted)">${snip}</div></li>`;
            }
            html += `</ul>`;
            await botTypingThenSay(html, 700);
            setStatus('Ø¢Ù†Ù„Ø§ÛŒÙ† âœ…');
            return;
          }
        }
      } catch (err) {
        console.warn('KB query failed', err);
      }
      // fallback
      await botTypingThenSay('Ù…ØªØ£Ø³ÙÙ…ØŒ Ø§Ù„Ø§Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø±ØªØ¨Ø·ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ú©Ø±Ø¯Ù…. Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ø¨Ù¾Ø±Ø³ ÛŒØ§ Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„/Ù…Ø­Ù„ Ù…ÙˆØ±Ø¯Ù†Ø¸Ø± Ø±Ø§ Ø¨Ú¯Ùˆ.', 600);
      setStatus('Ø¢Ù†Ù„Ø§ÛŒÙ† âœ…');
    }

    // main submit handler
    async function handleSubmit(e) {
      e && e.preventDefault();
      const raw = (input.value || '').trim();
      if (!raw) {
        await botTypingThenSay('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù…ØªÙ† Ú©ÙˆØªØ§Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù† ØªØ§ Ø¨ØªÙˆÙ†Ù… Ú©Ù…Ú©Øª Ú©Ù†Ù….');
        return;
      }

      appendMessage('user', esc(raw));
      input.value = '';
      input.disabled = true;
      sendBtn.disabled = true;

      // 1) detect intent (KB/product/hazard)
      let intent = null;
      try {
        if (window.KnowledgeEngine && typeof KnowledgeEngine.detectIntent === 'function') {
          intent = KnowledgeEngine.detectIntent(raw);
        }
      } catch (err) {
        console.warn('intent detection error', err);
        intent = null;
      }

      // If KnowledgeEngine thinks it's a KB question -> route to KB
      if (intent === 'knowledge' || (window.KnowledgeEngine && typeof KnowledgeEngine.isKBQuestion === 'function' && KnowledgeEngine.isKBQuestion(raw))) {
        await handleKBQuery(raw);
        input.disabled = false; sendBtn.disabled = false; input.focus();
        return;
      }

      // If explicit product intent -> go product flow (no chips, fully text-based)
      if (intent === 'product') {
        // if we already in step-based flow then use answers.hazard, else use raw as hazard
        const hazardGuess = raw;
        const picks = await findProducts({ hazard: hazardGuess, env: answers.env, pref: answers.pref, industry: answers.industry }, 6);
        // show summary + suggestions
        let html = `<p class="small">ğŸ” Ø¨Ø± Ø§Ø³Ø§Ø³ Ú¯ÙØªÙ‡Ù” Ø´Ù…Ø§ØŒ Ø§ÛŒÙ† Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…Ù†Ø§Ø³Ø¨â€ŒØ§Ù†Ø¯:</p><ul class="suggestions">`;
        for (const p of picks) {
          const title = esc(p.title_fa || p.title || 'Ù…Ø­ØµÙˆÙ„');
          const why = esc(p.why || '');
          const url = esc(p.url || '#');
          html += `<li><div><a class="prod-link" href="${url}" target="_blank" rel="noopener noreferrer">${title}</a></div><div class="small" style="margin-top:6px;color:var(--muted)">${why}</div></li>`;
        }
        html += `</ul><p class="small" style="margin-top:8px">Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ù…Ø§ÛŒÙ†Ø¯Ú¯ÛŒ ÛŒØ§ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ù‡Ø§ Ù…ÛŒØªÙˆÙ†ÛŒ Ø³ÙˆØ§Ù„ Ø¨Ù¾Ø±Ø³ÛŒ.</p>`;
        await botTypingThenSay(html, 700);
        input.disabled = false; sendBtn.disabled = false; input.focus();
        return;
      }

      // If intent 'hazard' or not detected -> continue step flow to collect context
      if (step < 4) {
        // if we're at initial step or continuing
        // Use current step rules from previous chat behavior
        if (step === 0) {
          // treat raw as industry if user typed industry-like word
          // use IndustryIndexer if available
          let best = null;
          try {
            if (window.IndustryIndexer && IndustryIndexer.bestMatch) {
              best = IndustryIndexer.bestMatch(raw);
            }
          } catch(e){ /* ignore */ }

          if (!best) {
            // if raw not recognized as industry, accept as industry text anyway
            answers.industry = raw;
          } else {
            answers.industry = best.name_fa || best.name_en || best.code || raw;
          }
          // ask next
          await botTypingThenSay(STEPS[1].q, 420);
          step = 1;
          input.placeholder = STEPS[1].ph;
          input.disabled = false; sendBtn.disabled = false; input.focus();
          return;
        }

        if (step === 1) {
          answers.hazard = raw;
          // quick check for known hazard tokens
          const low = raw.toLowerCase();
          const hazardKnown = /Ø¨Ø±Ø´|Ø³ÙˆØ±Ø§Ø®|Ø­Ø±Ø§Ø±Øª|Ú¯Ø±Ù…Ø§|Ù…ÙˆØ§Ø¯|Ø´ÛŒÙ…ÛŒ|Ø§Ø³ÛŒØ¯|Ø­Ù„Ø§Ù„|Ø¶Ø±Ø¨Ù‡|Ø³Ø§ÛŒØ´|Ù„Ø±Ø²Ø´|cut|puncture|heat|chemical|impact|abrasion/i;
          if (!hazardKnown.test(low)) {
            await botTypingThenSay(CLARIFY_PROMPT, 420);
            input.placeholder = "Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø±Ø´ / Ø³ÙˆØ±Ø§Ø® / Ø­Ø±Ø§Ø±Øª / Ù…ÙˆØ§Ø¯ Ø´ÛŒÙ…ÛŒØ§ÛŒÛŒ";
            input.disabled = false; sendBtn.disabled = false; input.focus();
            return;
          }
          await botTypingThenSay(STEPS[2].q, 420);
          step = 2;
          input.placeholder = STEPS[2].ph;
          input.disabled = false; sendBtn.disabled = false; input.focus();
          return;
        }

        if (step === 2) {
          answers.env = raw;
          const low = raw.toLowerCase();
          const envKnown = /Ø±ÙˆØºÙ†|Ù…Ø±Ø·ÙˆØ¨|Ø®Ø´Ú©|Ø³Ø±Ø¯|Ú¯Ø±Ù…|ÙØ¶Ø§ÛŒ Ø¨Ø§Ø²|Ø§Ù†Ø¨Ø§Ø±|oily|wet|cold|hot/i;
          if (!envKnown.test(low)) {
            await botTypingThenSay("Ù…Ø­ÛŒØ· Ø±Ø§ Ú©Ù…ÛŒ ÙˆØ§Ø¶Ø­â€ŒØªØ± Ø¨Ú¯Ùˆ â€” Ù…Ø«Ø§Ù„: Ø±ÙˆØºÙ†ÛŒØŒ Ù…Ø±Ø·ÙˆØ¨ØŒ Ø³Ø±Ø¯ ÛŒØ§ ÙØ¶Ø§ÛŒ Ø¨Ø§Ø².", 420);
            input.placeholder = "Ù…Ø«Ù„Ø§Ù‹: Ø±ÙˆØºÙ†ÛŒ / Ù…Ø±Ø·ÙˆØ¨ / Ø³Ø±Ø¯";
            input.disabled = false; sendBtn.disabled = false; input.focus();
            return;
          }
          await botTypingThenSay(STEPS[3].q, 420);
          step = 3;
          input.placeholder = STEPS[3].ph;
          input.disabled = false; sendBtn.disabled = false; input.focus();
          return;
        }

        if (step === 3) {
          answers.pref = raw;
          // now show recommendations using all collected answers
          await botTypingThenSay('Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¯Ù„â€ŒÙ‡Ø§... Ù„Ø·ÙØ§Ù‹ Ú†Ù†Ø¯ Ù„Ø­Ø¸Ù‡ ØµØ¨Ø± Ú©Ù†.', 700);
          const picks = await findProducts({ hazard: answers.hazard, env: answers.env, pref: answers.pref, industry: answers.industry }, 6);
          // show summary + picks
          appendMessage('bot', `<div class="small"><strong>Ø®Ù„Ø§ØµÙ‡Ù” ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§</strong>
            <ul style="margin:8px 0 0 12px;padding-left:12px;color:var(--muted);">
              <li>ØµÙ†Ø¹Øª: ${esc(answers.industry||'â€”')}</li>
              <li>Ø®Ø·Ø±: ${esc(answers.hazard||'â€”')}</li>
              <li>Ù…Ø­ÛŒØ·: ${esc(answers.env||'â€”')}</li>
              <li>ØªØ±Ø¬ÛŒØ­: ${esc(answers.pref||'â€”')}</li>
            </ul></div>`);
          let html = `<p class="small">ğŸ” Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ù‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø·:</p><ul class="suggestions">`;
          for (const p of picks.slice(0,8)) {
            const title = esc(p.title_fa || p.title || 'Ù…Ø¯Ù„');
            const url = esc(p.url || '#');
            const why = esc(p.why || '');
            html += `<li>ğŸ”¹ <a class="prod-link" href="${url}" target="_blank" rel="noopener noreferrer">${title}</a><div class="small" style="margin-top:6px;color:var(--muted)">${why}</div></li>`;
          }
          html += `</ul><p class="small" style="margin-top:8px">Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯ Â«Ø¯ÙˆØ¨Ø§Ø±Ù‡Â» Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ ÛŒØ§ Ø¨Ú¯Ùˆ Â«Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±Â».</p>`;
          await botTypingThenSay(html, 400);
          // reset step state
          step = 999;
          input.placeholder = 'Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ù†ÙˆÛŒØ³: "Ø¯ÙˆØ¨Ø§Ø±Ù‡"';
          input.disabled = false; sendBtn.disabled = false; input.focus();
          return;
        }
      }

      // final fallback: if nothing matched, ask clarify
      await botTypingThenSay('Ù…ØªÙˆØ¬Ù‡ Ù†Ø´Ø¯Ù… â€” Ù…Ù†Ø¸ÙˆØ±Øª Ø±Ùˆ Ú©Ù…ÛŒ ÙˆØ§Ø¶Ø­â€ŒØªØ± Ø¨Ú¯Ùˆ. Ù…Ø«Ù„Ø§Ù‹ Ø¨Ú¯Ùˆ Â«Ù…ÛŒâ€ŒØ®ÙˆØ§Ù… Ø¯Ø³ØªÚ©Ø´ Ø¶Ø¯Ø¨Ø±Ø´ Ø¨Ø±Ø§ÛŒ Ø¬ÙˆØ´Ú©Ø§Ø±ÛŒÂ» ÛŒØ§ Â«Ø¢Ø¯Ø±Ø³ Ù†Ù…Ø§ÛŒÙ†Ø¯Ú¯ÛŒ Ù…Ø´Ù‡Ø¯Â»', 500);

      input.disabled = false; sendBtn.disabled = false; input.focus();
    }

    // wire events
    form.addEventListener('submit', handleSubmit);
    sendBtn.addEventListener('click', handleSubmit);
    input.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSubmit(e); });

    // start
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
